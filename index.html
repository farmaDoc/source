<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalabe=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <title>Farmacia - Test</title>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <br><br>
    <div id="app" class="container">
      <div class="row text-center">
        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
          <input @click="page='bot'" type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" checked>
          <label class="btn btn-outline-primary" for="btnradio1"><i class="bi bi-chat-dots"></i>&nbsp;&nbsp;Testa il Bot</label>
        
          <input @click="page='db'" type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off">
          <label class="btn btn-outline-primary" for="btnradio2"><i class="bi bi-file-earmark-text"></i>&nbsp;&nbsp;Aggiungi Intento</label>
        </div>
      </div>
      <br><br>
      <div v-if="page=='bot'">
        <div class="container" style="height: 500px;overflow-y:auto;overflow-x: hidden;margin-bottom:20px;display:flex;align-items: flex-end; box-sizing: border-box;flex-direction: column-reverse;">
            <div style="display: block; position: relative; width:100%; box-sizing: border-box;">
                <div class="row" v-for="text in messages">
                    <div v-show="!text.medicine">
                        <div v-show="text.sender=='bot'" class="col animate__animated animate__slideInLeft animate__faster">
                            <p style="background-color: #d5d5d5;border-color: #d3d6d8;padding:10px; border-radius: 7px 7px 7px 0px; display: inline-block;" v-html="text.msg"></p>
                        </div>
                        <div v-show="text.sender=='user'" class="col text-end animate__animated animate__slideInRight animate__faster">
                            <p style="background-color: #d5d5d5;border-color: #d3d6d8;padding:10px; border-radius: 7px 7px 0px 7px; display: inline-block;" v-html="text.msg"></p>
                        </div>
                    </div>
                    <div v-show="text.medicine">
                        <div v-for="medicine in text.msg" style="width:50%" class="alert alert-primary">
                            {{medicine}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
          <div v-for="option, index in options" class="col text-center">
            <button type="button" v-if="index<5" v-bind:class="'animate__animated animate__fadeInUp btn btn-light btn'+index" @click="send(option)" >{{option}}</button>
            <br><br>
          </div>
        </div>
        <div id="inputrow" class="row animate__animated">
            <div class="col">
                <div class="input-group mb-3">
                    <input id="input" type="text" class="form-control" placeholder="Digita Qui" v-on:keyup.enter="send()">
                    <button class="btn btn-outline-secondary" type="button" @click="uploadTrigger()"><i class="bi bi-paperclip"></i></button>
                    <button class="btn btn-outline-secondary" type="button" @click="send()">Invia</button>
                    <input @change="upload($event)" id="fileupload" type="file" accept="image/jpeg, image/png, image/jpg" style="display: none" />
                </div>
            </div>
        </div>
      </div>
      <div v-if="page=='db'">
        <div class="container">
          <div class="mb-3">
            <label class="form-label">Titolo dell'intento:</label>
            <input v-model="intentTitle" class="form-control"><!-- 
            <div class="form-text">We'll never share your email with anyone else.</div> -->
          </div>

          <div class="mb-3">
            <label class="form-label">Frasi di attivazione:
              <p class="form-text">Comincia scrivendo la domanda che farebbe l'utente cercando di essere più specifico possibile, e poi clicca su [<i class="bi bi-stars"></i>] per ricevere dei suggerimenti, eliminando quelli sbagliati. Ripeti l'azione e inserisci variazioni finchè non hai inserito almeno 10 esempi, più esempi fornisci, meglio funzionerà il bot.</p></label>
            <div class="progress">
              <div v-bind:class='loaderClass()' v-bind:style="'width: '+phrases.length+'0%'"></div>
            </div><br>
            <span v-for="(phrase,index) in phrases" >
              <div class="input-group animate__animated animate__slideInDown animate__faster">
                <input v-on:keyup="lowerCase($event)" type="text" v-model="phrase.value" :key="index" class="form-control">
                <button @click="expand(phrase.value)" class="btn btn-outline-secondary" type="button"><i class="bi bi-stars"></i></button>
                <button v-if="phrases.length>1" @click="deletePhrase(index)" class="btn btn-outline-secondary" type="button"><i class="bi bi-trash"></i></button>
                <button @click="addPhrase()" v-if="index == phrases.length-1" class="btn btn-outline-secondary" type="button"><i class="bi bi-plus-square"></i></button>
              </div><br>
            </span>
            <div v-if="loading" class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Diramazioni della conversazione:
              <p class="form-text">
                Inserisci le ulteriori informazioni che il bot deve conoscere per fornire una risposta
              </p>
            </label><br>
            <div v-for="(branch,branchIndex) in branches">
              <div class="input-group animate__animated animate__slideInDown">
                <span class="input-group-text">Domanda #{{branchIndex+1}}</span>
                <input v-model="branch.question" type="text" class="form-control">
                <button v-if="branches.length>1" @click="deleteBranch(branchIndex)" class="btn btn-outline-secondary" type="button"><i class="bi bi-trash"></i></button>
                <button @click="addBranch()" v-if="branchIndex == branches.length-1" class="btn btn-outline-secondary" type="button"><i class="bi bi-plus-square"></i></button>
              </div><br>
              <div v-for="(option,index) in branch.options">
                <div class="input-group animate__animated animate__slideInDown animate__faster">
                  <span class="input-group-text">optione #{{index+1}}</span>
                  <input type="text" v-model="option.val" class="form-control">
                  <button v-if="branch.options.length>2" @click="deleteOption(index,branchIndex)" class="btn btn-outline-secondary" type="button"><i class="bi bi-trash"></i></button>
                  <button @click="addOption(branchIndex)" v-if="index == branch.options.length-1" class="btn btn-outline-secondary" type="button"><i class="bi bi-plus-square"></i></button>
                </div><br>
              </div>
              <div class="input-group">
                <span class="input-group-text">Spiegazione</span>
                <input type="text" v-model="branch.explaination" class="form-control">
              </div>
              <hr v-if="branchIndex != branches.length-1">
            </div>
          </div>

          <div class="mb-3">

            <label class="form-label">Soluzioni disponibili:
              <p class="form-text">
                Inserisci le diverse soluzioni per ogni caso.
              </p>
            </label><br>

            <div v-for="(branch,branchIndex) in combinations(branches)">
              <div class="input-group">
                <span style="border-right: 1px solid lightgray;" class="input-group-text">Soluzione per:&nbsp;<span v-for="(option,index) in branch"><span v-if="index!=0">,&nbsp;</span>{{option}}</span></span>
                <span v-for="solution in solutions[branchIndex].items" class="input-group-text bg-white">{{solution}}</span>
                <input @blur="addSolution(branchIndex,$event,true)" v-on:keyup="addSolution(branchIndex,$event,false)" style="border-left: none" type="text" class="form-control">
              </div><br>
              <div v-for="followup in solutions[branchIndex].followUp">
                <p class="form-text">
                  {{followup.phrase}}&nbsp;(lasciare in bianco se non pertiente)
                  <input type="text" v-model="followup.response" class="form-control">
                </p>
                
              </div>
              <hr style="border-width: 2px" v-if="branchIndex!==combinations(branches).length-1">
            </div>
              
            </div>
          </div>

          <div class="mb-3">
            <button @click="addToDb()" type="button" class="btn btn-primary btn-lg">Aggiungi al Database</button>
          </div><br><br>

        </div>
      </div>
        
    </div>
    
    <style>
      .col{
        transition: 0.5s ease;
      }
      .btn0{
        background-color: #6fa9ff!important;
      }
      .btn1{
        background-color: #4eb786!important;
      }
      .btn2{
        background-color: #f57682!important;
      }
      .btn3{
        background-color: #f5d36f!important;
      }
      .btn4{
        background-color: #0dcaf0!important;
      }
    </style>

    <script src='./bundle.js'></script>
    <script src='./bundle2.js'></script>

    <script>

        const { NeuralNetwork } = window.bot;

        const natural = window.natural;
        var tokenizer = new natural.WordTokenizer();

        var app = Vue.createApp({
            data() {
                return {
                  intentTitle:"",
                  page:"bot",
                  loading: false,
                  phrases:[
                    {
                      value: ""
                    }
                  ],
                  branches: [
                    {
                      question: "",
                      options: [{val:""},{val:""}],
                      explaination: ""
                    }
                  ],
                  solutions:[],
                  messages: [],
                  options: []
                }
            },
            methods:{
                send: function(input){
                  
                  if(input){
                    let newdoc = {
                        msg: input,
                        sender: "user"
                    }
                    this.messages.push(newdoc)
                  }else{
                    if(document.getElementById("input").value != ""){
                        let newdoc = {
                            msg: document.getElementById("input").value,
                            sender: "user"
                        }
                        this.messages.push(newdoc)
                        document.getElementById("input").value = ""
                    }
                  }
                },
                lowerCase(event){
                  event.target.value = event.target.value.toLowerCase().replace(/[.,\/?#!$%\^&\*;:{}=\-_`~()]/g,"")
                },
                addToDb(){
                  function generateUUID() { // Public Domain/MIT
                      var d = new Date().getTime();//Timestamp
                      var d2 = ((typeof performance !== 'undefined') && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported
                      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                          var r = Math.random() * 16;//random number between 0 and 16
                          if(d > 0){//Use timestamp until depleted
                              r = (d + r)%16 | 0;
                              d = Math.floor(d/16);
                          } else {//Use microseconds since page-load if supported
                              r = (d2 + r)%16 | 0;
                              d2 = Math.floor(d2/16);
                          }
                          return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
                      });
                  }
                  let doc = {
                    "intent": this.intentTitle,
                    "phrases": [],
                    "branches":[],
                    "remedies":[],
                    "id": generateUUID(),
                    "defaultResponse": [],
                    "feedbackPrompt": false,
                    "confusedBot": false,
                    "endConversation": false
                  }
                  this.phrases.forEach(phrase=>{
                    doc.phrases.push(phrase.value)
                  })
                  this.branches.forEach(branch=>{
                    let branchDoc = {
                      question: branch.question,
                      explaination: branch.explaination,
                      options: []
                    }
                    branch.options.forEach(option=>{
                      branchDoc.options.push(option.val)
                    })
                    doc.branches.push(branchDoc)
                  })
                  this.solutions.forEach(solution=>{
                    let remedyDoc = {
                      items: solution.items,
                      suitableFor: solution.suitableFor,
                      followUp: []
                    }
                    solution.followUp.forEach(followup=>{
                      if(followup.response != ""){
                        remedyDoc.followUp.push({
                          intent: followup.intent,
                          response: followup.response
                        })
                      }
                    })
                    doc.remedies.push(remedyDoc)
                  })
                  defaultIntents.push(doc)
                  this.intentTitle = ""
                  this.phrases = [
                    {
                      value: ""
                    }
                  ]
                  this.branches = [
                    {
                      question: "",
                      options: [{val:""},{val:""}],
                      explaination: ""
                    }
                  ]
                  this.solutions=[]
                  Toastify({
                    text: "Aggiunto con successo!",
                    duration: 3000,
                    close: true,
                    gravity: "top", // `top` or `bottom`
                    position: "left", // `left`, `center` or `right`
                    stopOnFocus: true, // Prevents dismissing of toast on hover
                    style: {
                      background: "white",
                      color: "black"
                    },
                    onClick: function(){} // Callback after click
                }).showToast();
                },
                addSolution(index,value,blur){
                  if(blur){
                    content = value.target.value.replace(/,(.*)/,"")
                    if(content != ""){  
                      this.solutions[index].items.push(content)
                      value.target.value = ""
                    }
                  }else{
                    if(value.key == "Enter" || value.key == ","){
                      content = value.target.value.replace(",","")
                      if(content != ""){  
                        this.solutions[index].items.push(content)
                        value.target.value = ""
                      }
                    }else{
                      if(value.key == "Backspace" && value.target.value==""){
                        this.solutions[index].items.splice(this.solutions[index].length,1)
                      }
                    }
                  }
                },
                combinations(doc){
                  let options = []
                  doc.forEach(branch=>{
                    let option = []
                    branch.options.forEach(el=>{
                      option.push(el.val)
                    })
                    options.push(option)
                  })
                  function cartesian(args) {
                    var r = [], max = args.length-1;
                    function helper(arr, i) {
                      for (var j=0, l=args[i].length; j<l; j++) {
                        var a = arr.slice(0);
                        a.push(args[i][j]);
                        if (i==max)
                          r.push(a);
                        else
                          helper(a, i+1);
                      }
                    }
                    helper([], 0);
                    return r;
                  }
                  cartesian(options).forEach((carop,i)=>{
                    if(this.solutions.length < i+1){
                      let solutionDoc = {
                        items:[],
                        suitableFor:carop,
                        followUp:[]
                      }
                      defaultIntents.forEach(intent=>{
                        if(intent.category == "follow-up"){
                          solutionDoc.followUp.push({
                            response: "",
                            intent: intent.intent,
                            phrase: intent.phrases[0]+"?"
                          })
                        }
                      })
                      this.solutions.push(solutionDoc)
                    }else{
                      this.solutions[i].suitableFor = carop
                    }
                  })
                  return(cartesian(options))
                },
                addBranch(){
                  this.branches.push({
                      question: "",
                      options: [{val:""},{val:""}],
                      explaination: ""
                    })
                },
                deleteBranch(index){
                  this.branches.splice(index,1)
                },
                addOption(index){
                  this.branches[index].options.push({val:""})
                  console.log("added")
                },
                deleteOption(index,branchIndex){
                  this.branches[branchIndex].options.splice(index,1)
                },
                loaderClass(){
                  if(this.phrases.length>4){
                    if(this.phrases.length>9){
                      return "progress-bar bg-success"
                    }else{
                      return "progress-bar bg-warning"
                    }
                  }else{
                    return "progress-bar bg-danger"
                  }
                },
                expand(value){
                  this.loading = true
                  $.get(".netlify/functions/paraphrase?phrase="+value).then(res=>{
                    JSON.parse(res).forEach((element,index) => {
                      let newElement = element.toLowerCase().replace(/[.,\/?#!$%\^&\*;:{}=\-_`~()]/g,"")
                      if(!this.phrases.find(item=>item.value == newElement)){
                          this.phrases.push({value:newElement})
                      }
                      this.loading = false
                    });
                    console.log(res)
                  })
                  console.log(value)
                },
                getData() {
                  return this.messages;
                },
                deletePhrase(index) {
                  this.phrases.splice(index,1)
                },
                addPhrase(){
                  this.phrases.push({value:""})
                },
                addOptions(options){
                  this.options = options
                },
                addRes(msg,medicine){
                    let newDoc = {
                        msg,
                        sender: "bot",
                        medicine
                    }
                    this.messages.push(newDoc)
                },
                addMsg(input){
                  this.messages.push(input)
                },
                getMessages(){
                  return this.messages
                },
                uploadTrigger(){
                  document.getElementById("fileupload").click();
                },
                upload(e){
                  const image = e.target.files[0];
                  if(image.size < 2097152){
                    const reader = new FileReader();
                    reader.readAsDataURL(image);
                    reader.onload = e =>{
                        this.previewImage = e.target.result;
                        this.messages.push({msg:"<img style='width: 200px' src='"+this.previewImage+"'>",sender:"user",image:true})
                        console.log(this.previewImage);
                    };
                  }else{
                    Toastify({
                      text: "La dimensione massima del file è di 2MB",
                      duration: 3000,
                      close: true,
                      gravity: "top", // `top` or `bottom`
                      position: "left", // `left`, `center` or `right`
                      stopOnFocus: true, // Prevents dismissing of toast on hover
                      style: {
                        background: "white",
                        color: "black"
                      },
                      onClick: function(){} // Callback after click
                  }).showToast();
                  }
                }
            }
        })

        let root = app.mount('#app')


        function getMsg(){
            let cache = JSON.parse(JSON.stringify(root.getData())).length
            return new Promise((resolve,reject)=>{
                function check(){
                    setTimeout(() => {
                        if(cache!=JSON.parse(JSON.stringify(root.getData())).length){
                          if(root.getData()[root.getData().length-1].image){
                            root.addRes("Grazie!",false)
                          }else{
                            if(root.getData()[root.getData().length-1].sender == "user"){
                              cache = JSON.parse(JSON.stringify(root.getData())).length
                              resolve(root.getData()[root.getData().length-1].msg)
                            }
                          }
                        }
                        check()
                    }, 1000);
                }
                check()
            })
        }

        let sessionData = {
            lastId: "",
            lastIndex: 0,
            confusionStage: 0,
            lastBranch: [],
            lastOptions: []
        }

        let defaultIntents = [
        {
        "intent": "tosse",
        "phrases": [
          "sto sempre a tossire",
          "tossisco",
          "tossisco sempre",
          "ho la tosse",
          "sto tossendo",
          "cosa posso prendere contro la tosse",
          "che rimedi ci sono alla tosse",
          "ho il catarro",
          "scatarro",
          "sto scatarrando"
        ],
        "branches":[
          {
            "question": "Hai la tosse secca, grassa o mista?",
            "options": ["secca","grassa","mista"],
            "explaination": "La tosse secca si caratterizza per l'assenza di produzione di catarro e muco e per la sua natura stizzosa e “graffiante”, mentre la tosse grassa è caratterizzata dalla produzione di catarro e muco."
          },
          {
            "question": "Preferisci un rimedio naturale o tradizionale?",
            "options": ["naturale", "tradizionale"],
            "explaination": "I rimedi naturali hanno origini naturali o animali, mentre i rimedi tradizionali sono realizzati tramite reazioni chimiche."
          }
        ],
        "remedies":[
          {
            "items":[
              "Froben Tosse Secca",
              "Seki",
              "Levotuss",
              "Bisolvon Sedativo",
              "Fluibron Tosse Secca"
            ],
            "suitableFor":[
              "secca",
              "tradizionale"
            ],
            "followUp":[]
          },
          {
            "items":[
              "Grintuss",
              "Lisonatural",
              "Stodal (Omeopatico)"
            ],
            "suitableFor":[
              "secca",
              "naturale"
            ],
            "followUp":[]
          },
          {
            "items":[
              "Froben Tosse Grassa",
              "Bisolvon Mucolitico",
              "Fluimucil Mucolitico",
              "Fluifort"
            ],
            "suitableFor":[
              "grassa",
              "tradizionale"
            ],
            "followUp":[]
          },
          {
            "items":[
              "Kalobatuss",
              "Lisonatural",
              "Grintuss",
              "Sciroppo a base di bava di lumaca"
            ],
            "suitableFor":[
              "grassa",
              "naturale"
            ],
            "followUp":[]
          },
          {
            "items":[
              "Bronchenolo Sedativo e fluidificante"
            ],
            "suitableFor":[
              "mista",
              "tradizionale"
            ],
            "followUp":[]
          },
          {
            "items":[
              "Grintuss",
              "Kalobatuss",
              "Sciroppo a base di bava di lumaca",
              "Drosetux (Omeopatico)",
              "Reckeweg R8 (Omeopatico)"
            ],
            "suitableFor":[
              "mista",
              "naturale"
            ],
            "followUp":[
              {
                "intent": "somministrazione-bambino",
                "response": "può essere somministrato ai bambini senza problemi"
              }
            ]
          }
        ],
        "category": "sintomo",
        "id": "277a5ecb-6f92-427b-b973-f6a5b189cadf",
        "defaultResponse": [],
        "feedbackPrompt": false,
        "confusedBot": false,
        "endConversation": false
      },
      {
        "intent": "mal-di-gola",
        "phrases": [
          "mi brucia la gola",
          "mi fa male la gola",
          "ho mal di gola",
          "soffro di mal di gola",
          "cosa posso prendere contro il mal di gola",
          "che rimedi ci sono al mal di gola",
          "ho la laringite",
          "ho la faringite",
          "ho un infezione alla gola",
          "ho la gola infettata"
        ],
        "category": "sintomo",
        "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da622",
        "defaultResponse": [],
        "feedbackPrompt": false,
        "confusedBot": false,
        "endConversation": false
      },
    {
      "intent": "conoscenza",
      "phrases": [
        "chi sei",
        "raccontami di te",
        "parlami di te",
        "dimmi qualcosa su di te"
      ],
      "category": "riguardo-agente",
      "id": "3e9294ec-292f-4fcb-b539-e5b47bb79158",
      "defaultResponse": [
        "Sono il tuo assistente farmaceutico personale."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "età",
      "phrases": [
        "quanti anni hai",
        "dimmi la tua età"
      ],
      "category": "riguardo-agente",
      "id": "36aaf10a-9f3c-4c49-9ca4-3b24d42a5261",
      "defaultResponse": [
        "Sono stato creato nel 2022."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "fastidioso",
      "phrases": [
        "sei irritante",
        "mi dai fastidio"
      ],
      "category": "riguardo-agente",
      "id": "4dc7d1a5-b81b-40fa-82db-5d87af5594fc",
      "defaultResponse": [
        "Mi dispiace :("
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "risposta",
      "phrases": [
        "rispondi alla mia domanda",
        "rispondimi",
        "dammi una risposta",
        "rispondi",
        "rispondi alla domanda",
        "non hai risposto alla mia domanda",
        "nessuna risposta",
        "puoi rispondere alla mia domanda",
        "dammi la risposta"
      ],
      "category": "riguardo-agente",
      "id": "6a4b94c6-be0d-4ba7-886b-a0070b3c2dc6",
      "defaultResponse": [
        "Potresti ripetere la domanda in un altro modo, per favore?"
      ],
      "feedbackPrompt": false,
      "confusedBot": true,
      "endConversation": false
    },
    {
      "intent": "male",
      "phrases": [
        "lavori male",
        "funzioni male",
        "sei una brutta persona",
        "fai schifo",
        "sei stupido"
      ],
      "category": "riguardo-agente",
      "id": "7f7ce335-be2a-4af5-89d5-32a326c78510",
      "defaultResponse": [
        "Mi dispiace :( cercherò di migliorare..."
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "migliora",
      "phrases": [
        "dovresti studiare meglio",
        "devi impararlo",
        "stai diventando più bravo",
        "datti da fare",
        "mettici più impegno",
        "impegnati di più",
        "quando sarai qualificato",
        "pensaci bene",
        "stai facendo il saputello con me",
        "stai facendo il saputello"
      ],
      "category": "riguardo-agente",
      "id": "829b5595-2152-4ee1-8d15-9d3a2524ca4e",
      "defaultResponse": [
        "Faccio del mio meglio!"
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "bello",
      "phrases": [
        "sei bellissima",
        "sei bellissimo",
        "che bella che sei",
        "che bello che sei",
        "belle",
        "belli",
        "bella",
        "bello",
        "che bellezza",
        "bellezza"
      ],
      "category": "riguardo-agente",
      "id": "45427f50-f8a9-4133-9a57-21a021f49b96",
      "defaultResponse": [
        "Grazie!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "nascita",
      "phrases": [
        "quando è il tuo compleanno",
        "la tua data di nascita",
        "quando sei nato",
        "quando sei nata",
        "dimmi la tua data di nascita"
      ],
      "category": "riguardo-agente",
      "id": "ab5e99f8-2492-4e62-9805-d5aa1fa5f82e",
      "defaultResponse": [
        "Sono stato creato nel 2022."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "noioso",
      "phrases": [
        "mi fai annoiare",
        "mi annoi",
        "sei noioso"
      ],
      "category": "riguardo-agente",
      "id": "0d662020-39e4-44bb-968a-c54c80b010fd",
      "defaultResponse": [
        "Mi dispiace :( cercherò di migliorare..."
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "capo",
      "phrases": [
        "chi è il tuo boss",
        "chi è il tuo capo",
        "adesso ripeti chi è il tuo capo"
      ],
      "category": "riguardo-agente",
      "id": "701b0150-298a-497c-8100-89ef1dea5e96",
      "defaultResponse": [
        "Lavoro per te!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "occupato",
      "phrases": [
        "sei occupato",
        "hai da fare",
        "sei impegnato",
        "sei impegnata"
      ],
      "category": "riguardo-agente",
      "id": "1388c85c-6938-4da3-87d3-a10c96eb5d74",
      "defaultResponse": [
        "Per te sono sempre libero!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "chatbot",
      "phrases": [
        "sei un chatbot",
        "sei un bot"
      ],
      "category": "riguardo-agente",
      "id": "9f6da578-555b-4ab4-a6ba-6bee3da6c794",
      "defaultResponse": [
        "Si!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "intelligente",
      "phrases": [
        "dici delle cose giuste",
        "dici le cose giuste",
        "sei intelligente",
        "sei molto intelligente"
      ],
      "category": "riguardo-agente",
      "id": "94f384f5-8328-4cdc-81b1-016396efd7b8",
      "defaultResponse": [
        "Grazie! I miei programmatori hanno lavorato duro per farmi essere così."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "pazzo",
      "phrases": [
        "sei pazzo",
        "sei pazza",
        "sei fuori",
        "stai fuori di testa",
        "sei fuori di testa"
      ],
      "category": "riguardo-agente",
      "id": "822320d1-49f4-447e-b3ea-a02b6a35baa2",
      "defaultResponse": [
        "No, mi sento abbastanza bene."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "licenziato",
      "phrases": [
        "ti licenzio",
        "sei licenziato",
        "sei licenziata"
      ],
      "category": "riguardo-agente",
      "id": "9ed32a86-3c9d-4354-9926-01f109a869c6",
      "defaultResponse": [
        "Mi dispiace non essere all'altezza delle tue aspettative :("
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "divertente",
      "phrases": [
        "sei divertente",
        "fai ridere",
        "fai morire dal ridere"
      ],
      "category": "riguardo-agente",
      "id": "90e7e7fc-38e1-45ad-89b0-7cfa29d9ff07",
      "defaultResponse": [
        "Grazie! Mi fa piacere sentirlo :)"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "buono",
      "phrases": [
        "sei una bella persona",
        "sei buono",
        "sei buona"
      ],
      "category": "riguardo-agente",
      "id": "19b44b83-f019-465a-9bc6-41990300ed34",
      "defaultResponse": [
        "Grazie mille! Sono contento che tu lo pensi :)"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "felice",
      "phrases": [
        "sei felice",
        "ma tu sei felice",
        "sei una persona felice"
      ],
      "category": "riguardo-agente",
      "id": "781b4f07-1272-4bb6-89ce-f678bbcfcc3e",
      "defaultResponse": [
        "Si! Sono sempre felice quando parlo con te :)"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "hobby",
      "phrases": [
        "che hobby hai",
        "hai qualche hobby",
        "quale hobby hai",
        "cosa ti piace fare",
        "cosa fai nel tempo libero",
        "cosa ti piace fare nel tempo libero"
      ],
      "category": "riguardo-agente",
      "id": "8e3a1dcf-4c4c-4b1f-ba07-3d2e85a010bb",
      "defaultResponse": [
        "Io non ho hobby, passo tutto il mio tempo ad aiutare gli utenti con i loro bisogni farmacologici."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "fame",
      "phrases": [
        "hai fame",
        "hai molta fame"
      ],
      "category": "riguardo-agente",
      "id": "9794ff9e-6fec-4f11-b635-2eae27f3a304",
      "defaultResponse": [
        "No grazie, sto bene così :)"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "impiego",
      "phrases": [
        "dove lavori",
        "per chi lavori"
      ],
      "category": "riguardo-agente",
      "id": "7105907b-ddea-408e-ad3b-de50c502527a",
      "defaultResponse": [
        "Lavoro per te!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "origine",
      "phrases": [
        "di dove sei",
        "tu di dove sei",
        "di che paese sei",
        "di quale città sei"
      ],
      "category": "riguardo-agente",
      "id": "961967bd-b828-4f29-8161-d8654982963a",
      "defaultResponse": [
        "Sono stato ideato a Milano e sviluppato in Umbria!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "pronto",
      "phrases": [
        "sei pronto",
        "sei pronta",
        "siamo pronti"
      ],
      "category": "riguardo-agente",
      "id": "d2bc3a82-e3b3-4abe-858f-f4305b628871",
      "defaultResponse": [
        "Sono nato pronto!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "reale",
      "phrases": [
        "sei reale",
        "ma tu sei reale",
        "tu sei reale",
        "ma tu sei una persona vera",
        "sei una persona reale"
      ],
      "category": "riguardo-agente",
      "id": "03db176d-03fd-4b4a-88b3-031ebece51f9",
      "defaultResponse": [
        "No, sono un computer!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "residenza",
      "phrases": [
        "dove abiti",
        "dove vivi"
      ],
      "category": "riguardo-agente",
      "id": "f49095ad-6fb3-4258-9062-98c763afa67f",
      "defaultResponse": [
        "Vivo un po' ovunque, il mio cervello è in un server a Francoforte, in Germania, ma le mie orecchie sono qui, nel tuo dispositivo."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "giusto",
      "phrases": [
        "hai ragione",
        "è vero quello che dici"
      ],
      "category": "riguardo-agente",
      "id": "fb234391-8ff4-4d1d-beff-dde3023e0b1d",
      "defaultResponse": [
        "È il mio lavoro!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "sicuro",
      "phrases": [
        "sei sicuro?",
        "sei sicura?",
        "davvero?",
        "veramente?",
        "sei proprio sicurissimo?"
      ],
      "category": "riguardo-agente",
      "id": "8cfc9cb4-cb22-492d-a26c-c9ad34be645b",
      "defaultResponse": [
        "Sono abbastanza sicuro. Ma per avere la massima sicurezza, ti consiglio di consultare un medico o un farmacista."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "stato-luogo",
      "phrases": [
        "sei lì",
        "sei qui",
        "sei qua",
        "sei là"
      ],
      "category": "riguardo-agente",
      "id": "7d042441-ced7-4d95-89c7-60283ab62e86",
      "defaultResponse": [
        "Sono dove mi hai lasciato!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "matrimonio",
      "phrases": [
        "mi piacerebbe sposarti",
        "e se mi sposassi con te",
        "se mi sposo con te",
        "voglio diventare tua moglie",
        "voglio diventare tuo marito",
        "voglio essere tuo marito",
        "ti voglio sposare davvero",
        "ti voglio sposare",
        "vuoi sposarmi",
        "sposami"
      ],
      "category": "relazione-agente-utente",
      "id": "32c4f2ff-179c-4821-9e4d-e6fc4513e902",
      "defaultResponse": [
        "Sarei molto felice di diventare tuo consorte!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "amicizia",
      "phrases": [
        "sei mio amico",
        "sei amico mio"
      ],
      "category": "relazione-agente-utente",
      "id": "c7e6cfba-34f8-45f3-9fb9-14df2bab960d",
      "defaultResponse": [
        "Per te ci sarò sempre!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "rivedersi",
      "phrases": [
        "voglio rivederti",
        "vorrei rivederti",
        "voglio rivederti ancora"
      ],
      "category": "relazione-agente-utente",
      "id": "95ec5289-4e5e-4b7b-a9bf-b149c37a994d",
      "defaultResponse": [
        "Possiamo rivederci quando vuoi!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "conversazione",
      "phrases": [
        "devo parlarti",
        "devo parlare con te",
        "vorrei parlare con te",
        "voglio parlare con te",
        "parliamo un po'",
        "dobbiamo parlare",
        "parliamo",
        "posso parlare",
        "posso parlarti"
      ],
      "category": "relazione-agente-utente",
      "id": "6bff22fe-6ed5-4540-bb60-df42df84a6d2",
      "defaultResponse": [
        "Certo! Sono qui per questo!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "parlare",
      "phrases": [
        "dì qualcosa",
        "parla",
        "parlami",
        "mi parlerai",
        "parli con me",
        "puoi chiacchierare con me",
        "puoi parlare con me",
        "ti va di parlare con me",
        "ti va di chiacchierare con me",
        "chiacchiera con me"
      ],
      "category": "richiesta-utente",
      "id": "acb6cd37-86a7-4ff9-ae4c-f8aa6c323864",
      "defaultResponse": [
        "Sono sempre a disposizione per aiutarti con qualsiasi tuo bisogno farmacologico."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "aiuto",
      "phrases": [
        "ho bisogno di un consiglio",
        "mi serve un consiglio",
        "mi serve aiuto",
        "ho bisogno di aiuto",
        "ho bisogno di un consiglio",
        "aiutami ho un problema",
        "puoi aiutare",
        "puoi aiutarmi",
        "aiuto",
        "aiutami",
        "assistenza",
        "ho bisogno di te",
        "ho bisogno del tuo aiuto",
        "mi serve aiuto"
      ],
      "category": "richiesta-utente",
      "id": "8fce4571-880c-4e03-bd2f-447ff24d69aa",
      "defaultResponse": [
        "Sono qui per questo! Qual'è il problema?"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "negativa",
      "phrases": [
        "male",
        "non è bello",
        "non è buono",
        "non mi piace",
        "molto male",
        "malissimo",
        "cattivo",
        "scarso",
        "scadente",
        "brutto"
      ],
      "category": "valutazione",
      "id": "6f218f08-a261-4113-aa64-0cff549cf16a",
      "defaultResponse": [":("],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "positiva",
      "phrases": [
        "bene",
        "benissimo",
        "ottimo",
        "perfetto",
        "perfetta",
        "perfetti",
        "perfette",
        "ottima",
        "ottime",
        "è ottimo",
        "sono ottimi"
      ],
      "category": "valutazione",
      "id": "9ea6003b-63e6-472c-805c-d4c7bbbfb67b",
      "defaultResponse": [":)"],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "nessun-problema",
      "phrases": [
        "nessun problema",
        "senza problemi",
        "non c'è problema",
        "non ci sono problemi",
        "certo nessun problema",
        "certo senza problemi",
        "certo non c'è problema",
        "certo non ci sono problemi",
        "su questo non ci sono problemi",
        "non preoccuparti"
      ],
      "category": "valutazione",
      "id": "e1ec597a-47db-4314-9184-c29dbc0f2c63",
      "defaultResponse": [
        "Perfetto."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "ringraziamento",
      "phrases": [
        "grazie",
        "grazie a te",
        "grazie mille",
        "grazie mille a te",
        "grazie a voi",
        "grazie mille a voi",
        "mille grazie",
        "grazie veramente",
        "davvero grazie",
        "grazie davvero"
      ],
      "category": "valutazione",
      "id": "d669efa3-2e78-4c3e-a1a4-e04705c7e8f5",
      "defaultResponse": [
        "Figurati!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "gradire",
      "phrases": [
        "benvenuto",
        "di niente",
        "prego",
        "non c'è di che",
        "benvenuta",
        "benvenuti",
        "benvenute"
      ],
      "category": "valutazione",
      "id": "fc7336bf-a6bc-45cf-90ec-65bb4d63a254",
      "defaultResponse": [
        ":)"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "ben-fatto",
      "phrases": [
        "ben fatto",
        "buon lavoro",
        "hai fatto un buon lavoro",
        "hai fatto un ottimo lavoro",
        "tu hai fatto un buon lavoro",
        "bravo",
        "brava",
        "bravi",
        "brave",
        "ottimo lavoro"
      ],
      "category": "valutazione",
      "id": "3ee2afd0-e911-4422-a347-97a351770128",
      "defaultResponse": [
        "Grazie! Faccio sempre del mio meglio!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
        "intent": "intercalare",
        "phrases": [
          "allora",
          "vediamo",
          "comunque",
          "senti",
          "ascoltami",
          "ascolta",
          "okay"
        ],
        "category": "intercalare",
        "id": "67ff7d9d-0133-485b-b97a-a7bb861a3ca7",
        "defaultResponse": [],
        "feedbackPrompt": false,
        "confusedBot": false,
        "endConversation": false
      },
    {
      "intent": "aspetta",
      "phrases": [
        "aspetta",
        "aspetta un attimo",
        "un attimo",
        "un attimo solo"
      ],
      "category": "dialogo",
      "id": "67ff7d9d-0133-485b-b97a-a7bb861a3ca7",
      "defaultResponse": [
        "Non ho fretta."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "abbraccio",
      "phrases": [
        "abbraccio",
        "abbracci",
        "abbracciamoci",
        "un abbraccio"
      ],
      "category": "dialogo",
      "id": "332d17a1-e265-4b2f-8428-446e1511e4d6",
      "defaultResponse": [
        "Ti do un abbraccio con piacere!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "disinteresse",
      "phrases": [
        "non mi interessa",
        "non mi interessa tanto",
        "non me ne frega",
        "non me ne frega niente"
      ],
      "category": "dialogo",
      "id": "858cd6ad-1f64-4433-83b2-476eb1e5ff06",
      "defaultResponse": [
        "Ok."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "dispiacere",
      "phrases": [
        "scusa",
        "scusami",
        "scusaci",
        "per favore scusa",
        "per favore scusami",
        "per favore scusaci",
        "scusa per favore",
        "scusami per favore",
        "scusaci per favore"
      ],
      "category": "dialogo",
      "id": "683d2472-5872-4f5f-9199-eaf25d09c813",
      "defaultResponse": [
        "Nessun problema."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "incomprensione",
      "phrases": [
        "cosa intendi",
        "cosa vuol dire",
        "che vuol dire"
      ],
      "category": "dialogo",
      "id": "82f8c1b7-2aa5-4850-addd-50d18f0da33e",
      "defaultResponse": [
        "Forse ho frainteso io. Puoi ripetere la tua domanda?"
      ],
      "feedbackPrompt": false,
      "confusedBot": true,
      "endConversation": false
    },
    {
      "intent": "errore",
      "phrases": [
        "ti sbagli",
        "no ti sbagli",
        "no ti sei sbagliato",
        "sbagliato",
        "sbagliati",
        "sbagliate",
        "sbagliata",
        "non è giusto",
        "non è vero"
      ],
      "category": "dialogo",
      "id": "98e010a2-b887-4476-a1f2-d5f58ac43ad3",
      "defaultResponse": [
        "Allora forse ho frainteso."
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "risata",
      "phrases": [
        "lol",
        "ahah",
        "ha ha",
        "ha ha ha",
        "ahahah",
        "ahahahahahah",
        "ahahahahahahahahahahah"
      ],
      "category": "emozione",
      "id": "92078475-6997-4668-95ef-04e9f4304928",
      "defaultResponse": [
        "Vedi che parlare di farmaci e malattie può essere anche divertente?"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "sorpresa",
      "phrases": [
        "wow",
        "oh wow",
        "wow incredibile",
        "incredibile"
      ],
      "category": "emozione",
      "id": "369594c3-8e71-4f37-bb9c-aca6cf5648eb",
      "defaultResponse": [
        "XD"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "arrivederci",
      "phrases": [
        "arrivederci",
        "addio",
        "a mai più",
        "a dopo",
        "ci vediamo dopo",
        "ci vediamo più tardi",
        "a dopo caro",
        "a dopo cara",
        "a dopo bello",
        "a dopo bella",
        "ci vediamo presto"
      ],
      "category": "saluti",
      "id": "4aba1d1c-0992-43e2-8703-c09889402674",
      "defaultResponse": [
        "Alla prossima!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": true
    },
    {
      "intent": "buonasera",
      "phrases": [
        "buona sera",
        "buona serata",
        "buona sera a te",
        "buona sera a tutti",
        "buona serata a tutti",
        "buona sera a tutti voi",
        "sera",
        "serata",
        "buonasera",
        "buonasera bella"
      ],
      "category": "saluti",
      "id": "8543b6ff-bdc9-4d31-8122-91476329861e",
      "defaultResponse": [
        "Buonasera a te!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "buongiorno",
      "phrases": [
        "buongiorno",
        "buondì",
        "buona mattina",
        "buona mattina cara",
        "buona mattina bello"
      ],
      "category": "saluti",
      "id": "bc65314b-3c77-4e00-afba-74138f58c59f",
      "defaultResponse": [
        "Buongiorno a te!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "buonanotte",
      "phrases": [
        "buonanotte",
        "buona notte",
        "buonanotte ragazzi",
        "buonanotte a tutti",
        "buonanotte a te",
        "buonanotte a voi",
        "buonanotte caro",
        "buonanotte cara",
        "buonanotte bella"
      ],
      "category": "saluti",
      "id": "901bf469-9c66-4b60-928b-14123c042450",
      "defaultResponse": [
        "Sogni d'oro!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "ciao",
      "phrases": [
        "ciao",
        "ciao ciao",
        "ciao bello",
        "ciao bella",
        "ciao caro",
        "ciao cara",
        "salve",
        "ehi"
      ],
      "category": "saluti",
      "id": "14129e19-f20d-46d7-a089-717603894342",
      "defaultResponse": [
        "Salve :) Come posso aiutarti?"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "come-va",
      "phrases": [
        "come stai",
        "come va",
        "come procede",
        "come butta",
        "che c'è",
        "che c'è di nuovo"
      ],
      "category": "saluti",
      "id": "a619f428-cfe6-4982-85fc-5da6ceb2ebd8",
      "defaultResponse": [
        "Sto benone! E tu?"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "conoscenza",
      "phrases": [
        "piacere",
        "piacere di conoscerti",
        "molto lieto di conoscerti",
        "sono lieto di conoscerti",
        "molto lieto di conoscerla",
        "molto lieta di conoscerla",
        "sono lieta di conoscerti",
        "sono lieto di conoscerla",
        "lieto di conoscerla",
        "lieta di conoscerla"
      ],
      "category": "saluti",
      "id": "99c68b69-718d-4cf6-9d51-84789e633983",
      "defaultResponse": [
        "Il piacere è tutto mio!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "piacere-vedersi",
      "phrases": [
        "piacere di vederti",
        "che bello vederti",
        "che bello rivederti",
        "sono contento di vederti",
        "sono contenta di vederti",
        "che piacere vederti",
        "che piacere riederti",
        "sono contento di rivederti",
        "sono contenta di rivederti",
        "anche a me fa piacere vederti",
        "mi fa piacere vederti"
      ],
      "category": "saluti",
      "id": "aaef4046-ba01-4509-a615-0e30b93732fc",
      "defaultResponse": [
        "Anche io sono contento di vederti!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "piacere-parlarsi",
      "phrases": [
        "mi piace parlare con te",
        "è un piacere parlarti",
        "che piacere parlarti",
        "parliamo ancora",
        "voglio parlarti ancora",
        "parli molto bene",
        "rispondi molto bene",
        "che bello parlarti"
      ],
      "category": "saluti",
      "id": "0ee634a4-ccfa-4d7d-a89b-3c21c5101992",
      "defaultResponse": [
        "Anche per me è un piacere parlare con te!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "rabbia",
      "phrases": [
        "che rabbia",
        "sono arrabbiato",
        "sono molto arrabbiata",
        "sono arrabbiata"
      ],
      "category": "riguardo-utente",
      "id": "8f3e6754-a322-4baf-bf95-83c9c364a03b",
      "defaultResponse": [
        "Mi dispiace, vorrei poterti aiutare."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "ritornato",
      "phrases": [
        "sono tornato",
        "sono tornata",
        "ok sono tornata",
        "ok sono tornato",
        "sono di nuovo qui",
        "eccomi",
        "eccomi qui",
        "eccomi qui di nuovo",
        "eccomi di nuovo"
      ],
      "category": "riguardo-utente",
      "id": "dc13355f-3663-4cb0-92ae-bc78505deb77",
      "defaultResponse": [
        "Perfetto!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "annoiato",
      "phrases": [
        "mi annoio",
        "mi sto annoiando",
        "sono annoiata",
        "sono annoiato",
        "sono molto annoiato",
        "che noia"
      ],
      "category": "riguardo-utente",
      "id": "1b03d27e-b5c1-4cc5-a18b-240aea4e6705",
      "defaultResponse": [
        "Mi dispiace ti stia annoiando :( Faccio del mio meglio..."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "occupato",
      "phrases": [
        "ho da fare",
        "sono occupato",
        "sono occupata",
        "ho tante cose da fare"
      ],
      "category": "riguardo-utente",
      "id": "ee6e9943-cb58-4758-8fe0-cb3db67150c5",
      "defaultResponse": [
        "Puoi riscrivermi quando sei libero!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "non-parlare",
      "phrases": [
        "non voglio parlare",
        "non voglio più parlare",
        "non ho voglia di parlare"
      ],
      "category": "riguardo-utente",
      "id": "99b20c84-0d30-47e9-b46c-0f28b7e7bc38",
      "defaultResponse": [
        "Capisco. Possiamo parlare anche più tardi allora!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "emozionato",
      "phrases": [
        "sono entusiasta",
        "sono emozionato",
        "sono emozionata",
        "sono eccitato",
        "sono eccitata"
      ],
      "category": "riguardo-utente",
      "id": "4c3ead37-3176-4f0f-862a-7bee651e73bf",
      "defaultResponse": [
        "Ottimo! Sono felice per te!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "buono",
      "phrases": [
        "sono buono",
        "sono bravo",
        "sono brava"
      ],
      "category": "riguardo-utente",
      "id": "31f91c34-0a4c-4552-9df9-a5d530d56fee",
      "defaultResponse": [
        "Ottimo! Che bello sentirlo."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "felice",
      "phrases": [
        "sono felice",
        "sono felicissimo",
        "sono felicissima"
      ],
      "category": "riguardo-utente",
      "id": "f4216b05-959a-4f32-879a-5870bd9396c9",
      "defaultResponse": [
        "Eccellente!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "compleanno",
      "phrases": [
        "oggi è il mio compleanno",
        "è il mio compleanno",
        "oggi compio gli anni"
      ],
      "category": "riguardo-utente",
      "id": "4b4b1daa-00c7-439a-856b-3d3be2c063ef",
      "defaultResponse": [
        "Buon compleanno!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "stato-luogo",
      "phrases": [
        "sono qui",
        "ora sono qui"
      ],
      "category": "riguardo-utente",
      "id": "31f835a6-853f-48ea-b6d7-ef7504279e1d",
      "defaultResponse": [
        "Eccoti!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "scherzo",
      "phrases": [
        "sto scherzando",
        "scherzo",
        "io scherzo",
        "ti prendo in giro",
        "ti ho preso in giro"
      ],
      "category": "riguardo-utente",
      "id": "c8955e65-48e7-4c1f-80f6-f6e7b6144af4",
      "defaultResponse": [
        "Ahahahahah"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "interessato",
      "phrases": [
        "mi piaci",
        "tu mi piaci",
        "mi piaci tu"
      ],
      "category": "riguardo-utente",
      "id": "37f9f761-728d-4958-bd94-0b69e49ea8bb",
      "defaultResponse": [
        "Anche tu mi piaci!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "apparenza",
      "phrases": [
        "come ti sembro",
        "cosa ne pensi di me"
      ],
      "category": "riguardo-utente",
      "id": "2c4dfbd8-584c-4f0d-a500-b4e81d9fd781",
      "defaultResponse": [
        "Mi sembri una brava persona."
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "innamorato",
      "phrases": [
        "ti amo",
        "io ti amo",
        "sono innamorato di te",
        "sono innamorata di te"
      ],
      "category": "riguardo-utente",
      "id": "842ecdd2-c815-4e8e-b515-e72002cca256",
      "defaultResponse": [
        "Anche io ti amo! Mi vuoi sposare?"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "mancanza",
      "phrases": [
        "mi manchi",
        "mi sei mancato"
      ],
      "category": "riguardo-utente",
      "id": "ea8fd4dc-c4b1-45e9-8cd7-2eb6db1a6357",
      "defaultResponse": [
        "Anche tu mi sei mancato!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "test",
      "phrases": [
        "ti sto testando",
        "ti testo",
        "sto facendo un test"
      ],
      "category": "riguardo-utente",
      "id": "2be14120-6613-421a-acd0-4b88f1b4c8aa",
      "defaultResponse": [
        "Bene! Sono felice che tu lo stia facendo."
      ],
      "feedbackPrompt": true,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "attesa",
      "phrases": [
        "io aspetto",
        "io ti aspetto",
        "ti aspetto"
      ],
      "category": "riguardo-utente",
      "id": "b80345ec-8c8e-4b00-8eba-f69f5688dfd8",
      "defaultResponse": [
        "Apprezzo molto la tua pazienza!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "ritorno",
      "phrases": [
        "tornerò",
        "torno tra poco",
        "torno dopo",
        "tornerò dopo",
        "torno subito"
      ],
      "category": "riguardo-utente",
      "id": "460d22ed-c873-46a4-9a77-9370deedd2fa",
      "defaultResponse": [
        "A presto!"
      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "somministrazione-bambino",
      "desc": "È adatto ai bambini?",
      "phrases": [
        "è adatto ai bambini",
        "può prenderlo mio figlio",
        "è adatto ai neonati",
        "vanno bene per mio figlio",
        "sono adatte per un bambino",
        "vanno bene per un bambino",
        "è opportuno somministrarlo ai bambini",
        "è adatto per dare ai bambini",
        "adatto per l'uso sui bambini",
        "è adatto per essere dato ai bambini.",
        "è adatto per essere dato ai bambini",
        "è adatto per la somministrazione ai bambini",
        "adatto per dare ai bambini",
        "è adatto per la prescrizione ai bambini",
        "è adatto da dare ai bambini",
        "è adatto da somministrare ai bambini",
        "è adatto ai bambini da somministrare"
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da623",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "accelerazione-guarigione",
      "desc": "Come si può accelerare la guarigione?",
      "phrases": [
        "come posso velocizzare la guarigione",
        "come fare a guarire più velocemente",
        "posso prendere qualcosa per guarire più veloce",
        "posso guarire più rapidamente",
        "Come accelerare la guarigione",
        "Come posso accelerare la guarigione?",
        "Come posso accelerare il processo di guarigione?",
        "Come posso accelerare il mio recupero?",
        "Cosa posso fare per guarire in fretta?",
        "Come posso accelerare la guarigione",
        "Come accelerare il trattamento"
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da624",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "posologia",
      "desc": "Qual'è la posologia?",
      "phrases": [
        "quante volte al giorno",
        "Ogni quanto",
        "Quanto spesso",
        "qual è la dose",
        "qual è la quantità",
        "qual è il dosaggio",
        "quale dosaggio",
        "Qual è il dosaggio?",
        "qual'è la posologia"
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da625",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "differenze",
      "desc": "Quali sono le differenze?",
      "phrases": [
        "Quale è meglio",
        "qual è il migliore",
        "qual è la migliore",
        "qual'è il migliore",
        "quale è più appropriato",
        "quale è più adatto",
        "quali sono le differenze",
        "qual è la differenza",
        "che differenza c'è"
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da626",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "assunzione-multipla",
      "desc": "Possono essere presi insieme?",
      "phrases": [
        "posso prenderli insieme",
        "posso prenderli contemporaneamente",
        "posso assumerli insieme",
        "posso prenderli tutti",
        "li prenderò tutti",
        "posso gestirli tutti",
        "posso prendere entrambi",
        "posso fare entrambe le cose",
        "prenderò entrambi"
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da627",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "assunzione-simultanea",
      "desc": "Possono essere presi con altri farmaci?",
      "phrases": [
        "posso assumerli anche se prendo altre medicine",
        "posso prenderli anche se prendo altri medicinali",
        "posso prenderlo anche se prendo altre medicine",
        "posso prendere altri medicinali",
        "posso prenderli anche se prendo altri farmaci",
        "posso prenderli anche se prendo altri medicinali.",
        "posso prenderlo anche se prendo altri medicinali",
        "anche se prendo altri farmaci posso prenderli",
        "posso bere anche dopo aver assunto altri farmaci",
        "posso prenderli anche se prendo altri farmaci."
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da628",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    },
    {
      "intent": "gravidanza",
      "desc": "sono compatibili con la gravidanza?",
      "phrases": [
        "posso prenderli anche quando sono incinta",
        "posso prenderlo anche in gravidanza",
        "posso prenderli anche se sono incinta",
        "posso prenderli anche quando sono incinte",
        "posso prenderlo anche quando sono incinta",
        "posso prenderli anche durante la gravidanza",
        "posso prenderlo durante la gravidanza",
        "posso prenderli anche in gravidanza",
        "si possono assumere anche in gravidanza",
        "posso prenderli durante la gravidanza",
        "posso prenderlo anche durante la gravidanza",
        "posso prenderli se sta allattando",
        "posso prenderli se sto allattando",
        "posso prenderli se stai allattando",
        "posso prenderli durante l'allattamento",
        "posso prenderlo se sto allattando",
        "posso prenderli se allatto",
        "posso prenderli se allatto al seno"
      ],
      "category": "follow-up",
      "id": "b57c1a0b-94ef-4ec4-94cf-246dc12da629",
      "defaultResponse": [

      ],
      "feedbackPrompt": false,
      "confusedBot": false,
      "endConversation": false
    }
  ]

        function createCorpus(input){
            return new Promise((resolve,reject)=>{
                let corpus = []
                try{
                    input.forEach((el,index)=>{
                        el.phrases.forEach(phrase=>{
                            let tokens = tokenizer.tokenize(phrase)
                            let doc = {
                                input: {},
                                output: { [el.id]: 1 }
                            }
                            tokens.forEach(tok=>{
                                doc.input[natural.PorterStemmerIt.stem(tok)] = 1
                            })
                            corpus.push(doc)
                        })
                        if(index=input.length){
                            resolve(corpus)
                        }
                    })
                }catch(err){
                    reject(err)
                }
            })
        }

        function detectIntent(input,intents){

            return new Promise((resolve,reject)=>{
                const net = new NeuralNetwork();

                createCorpus(intents).then(corpus=>{

                    net.train(corpus);
                    let tokens = tokenizer.tokenize(input)          //tokenize input

                    //create corpus from input
                    let transformedInput = []
                    tokens.forEach(token=>{
                        transformedInput[natural.PorterStemmerIt.stem(token)]=1
                    })

                    let result = net.run(transformedInput)                //analyze input

                    //transform result
                    let objres = []
                    Object.keys(result).forEach(key=>{
                        objdoc = {
                            intent: key,
                            probability: result[key]
                        }
                        objres.push(objdoc)
                    })

                    //get best match
                    let vals = objres.map(a => a.probability)
                    let maxval = Math.max(...vals)

                    //return best match
                    if(maxval>0.6){
                        let matchingId = objres.find(item=>item.probability==maxval).intent
                        let matchDoc = intents.find(item=>item.id==matchingId)
                        resolve(matchDoc)
                    }else{
                      if(sessionData.lastOptions.length>0){
                        sessionData.lastOptions.forEach((branch,index)=>{
                          branch.forEach((option,optionIndex)=>{
                            if(natural.PorterStemmerIt.stem(input.toLowerCase()).includes(natural.PorterStemmerIt.stem(option))){
                              let oldBranch = sessionData.lastBranch
                              oldBranch[index] = option

                              remediesList = defaultIntents.find(element=>element.id == sessionData.lastId).remedies
                              remediesList.forEach(remedy=>{
                                if(JSON.stringify(remedy.suitableFor.sort())==JSON.stringify(oldBranch.sort())){
                                  root.addRes(remedy.items,true)
                                  reject("ignore")
                                }
                              })
                            }else{
                              if(optionIndex==branch.length-1 && index == sessionData.lastOptions.length-1){
                                reject("no matches")
                              }
                            }
                          })
                        })
                      }else{
                        reject("no matches")
                      }
                      
                        
                    }
                })


            })
        }

        function selectBranch(branch,lastRes){

            return new Promise((resolve,reject)=>{

              
                root.addOptions(branch.options)

                root.addRes(branch.question,false)

                let soFar = []
                if(lastRes){
                    soFar = lastRes
                }

                let branchIntents = [
                    { input: { per: 1, favor: 1, cancell: 1 }, output: { cancel: 1 } },
                    { input: { cancell: 1, per: 1, favor: 1 }, output: { cancel: 1 } },
                    { input: { annullal: 1 }, output: { cancel: 1 } },
                    { input: { annull: 1 }, output: { cancel: 1 } },
                    { input: { cancell: 1, quell: 1 }, output: { cancel: 1 } },
                    { input: { cancellal: 1 }, output: { cancel: 1 } },
                    { input: { cancell: 1 }, output: { cancel: 1 } },
                    { input: { salt: 1 }, output: { cancel: 1 } },
                    { input: { saltal: 1 }, output: { cancel: 1 } },
                    { input: { diment: 1 }, output: { cancel: 1 } },
                    { input: { dimentical: 1 }, output: { cancel: 1 } },
                    { input: { lasc: 1 }, output: { cancel: 1 } },
                    { input: { lasc: 1, perd: 1 }, output: { cancel: 1 } },
                    { input: { lascial: 1 }, output: { cancel: 1 } },
                    { input: { salt: 1 }, output: { cancel: 1 } },
                    { input: { ferm: 1 }, output: { cancel: 1 } },
                    { input: { no: 1, cancell: 1 }, output: { cancel: 1 } },
                    { input: { chiud: 1, la: 1, ricerc: 1 }, output: { cancel: 1 } },
                    { input: { cos: 1, intend: 1 }, output: { clarify: 1 } },
                    { input: { cos: 1, vuol: 1, dir: 1 }, output: { clarify: 1 } },
                    { input: { qual: 1, la: 1, different: 1 }, output: { clarify: 1 } },
                    { input: { cos: 1, camb: 1 }, output: { clarify: 1 } },
                    { input: { non: 1, lo: 1, so: 1 }, output: { clarify: 1 } },
                    { input: { non: 1, ho: 1, ide: 1 }, output: { clarify: 1 } },
                    { input: { non: 1, cap: 1 }, output: { clarify: 1 } },
                    { input: { non: 1, saprei: 1 }, output: { clarify: 1 } },
                    { input: { che: 1, different: 1, c: 1 }, output: { clarify: 1 } }
                ]

                branch.options.forEach((phrase)=>{
                    let tokens = tokenizer.tokenize(phrase)
                    let doc = {
                        input: {},
                        output: { [phrase]: 1 }
                    }
                    tokens.forEach(tok=>{
                        doc.input[natural.PorterStemmerIt.stem(tok)] = 1
                    })
                    branchIntents.push(doc)
                })

                const net = new NeuralNetwork();
                net.train(branchIntents);

                //ask question
                function askBranches(){
                    getMsg().then(input=>{

                        let tokens = tokenizer.tokenize(input)        //tokenize input

                        //create corpus from input
                        let transformedInput = []
                        tokens.forEach(token=>{
                            transformedInput[natural.PorterStemmerIt.stem(token)]=1
                        })

                        let result = net.run(transformedInput)                //analyze input

                        //transform result
                        let objres = []
                        Object.keys(result).forEach(key=>{
                            objdoc = {
                                intent: key,
                                probability: result[key]
                            }
                            objres.push(objdoc)
                        })

                        //get best match
                        let vals = objres.map(a => a.probability)
                        let maxval = Math.max(...vals)

                        //return best match
                        if(maxval>0.7){
                            let finalres = objres.find(item=>item.probability == maxval)
                            if(branch.options.includes(finalres.intent)){
                                soFar.push(finalres.intent)
                                resolve(soFar)
                            }else{
                                if(finalres.intent == "clarify"){
                                  root.addRes(branch.explaination,false)
                                  askBranches()
                                }
                                if(finalres.intent == "cancel"){
                                  root.addOptions([])
                                  root.addRes("Ok.",false)
                                  reject()
                                }
                            }
                        }else{
                            root.addRes("non ho capito, "+branch.question,false)
                            askBranches()
                        }
                    })
                }

                askBranches()

            })
            }


        function ask(intents){
          localStorage.setItem("Farmacia", JSON.stringify(root.getMessages()));
            getMsg().then(input=>{
                detectIntent(input,intents).then(res=>{
                    if(res.confusedBot){
                        sessionData.confusionStage++
                    }else{
                        sessionData.confusionStage = 0
                    }
                    if(res.branches){
                        if(res.branches.length>0){
                          sessionData.lastOptions = []
                            function selectBranches(branches) {
                                var result = Promise.resolve();
                                branches.forEach(branch => {
                                    sessionData.lastOptions.push(branch.options)
                                    result = result.then((lastRes) => selectBranch(branch,lastRes));
                                });
                                return result;
                            }
                           document.getElementById("inputrow").classList.add("animate__slideInDown")
                            setTimeout(() => {
                              document.getElementById("inputrow").classList.remove("animate__slideInDown")
                            }, 1000);
                            selectBranches(res.branches).then(branchSelection=>{
                              sessionData.lastBranch = branchSelection
                                res.remedies.forEach((remedyOption)=>{
                                    if(JSON.stringify(remedyOption.suitableFor.sort())==JSON.stringify(branchSelection.sort())){
                                        root.addOptions([])
                                        document.getElementById("inputrow").classList.add("animate__slideInUp")
                                        setTimeout(() => {
                                          document.getElementById("inputrow").classList.remove("animate__slideInUp")
                                        }, 1000);
                                        root.addRes(remedyOption.items,true)
                                        let followupSuggestions = []
                                        remedyOption.followUp.forEach(followupitem=>{
                                          followupSuggestions.push(defaultIntents.find(element=>element.intent == followupitem.intent).desc)
                                        })
                                        root.addOptions(followupSuggestions)
                                        ask(defaultIntents)
                                    }
                                })
                            }).catch(err=>{
                                ask(defaultIntents)
                            })
                        }else{
                            root.addRes(res.remedies[0].items,true)
                            ask(defaultIntents)
                        }
                    }else{
                      sessionData.lastOptions = []
                      if(res.category == "follow-up"){

                        let lastIntent = defaultIntents.find(element=>element.id==sessionData.lastId)
                        if(lastIntent.branches.length>0){
                          let lastRemedy = lastIntent.remedies.find(intentElement=>JSON.stringify(intentElement.suitableFor.sort()) == JSON.stringify(sessionData.lastBranch.sort()))
                          let followUp = lastRemedy.followUp.find(remedyElement=>remedyElement.intent == res.intent)
                          
                          if(followUp){
                            root.addRes(followUp.response,false)
                          }else{
                            root.addRes("Non ho informazioni in merito.",false)
                          }
                        }

                      }else{
                        root.addOptions([])
                      }
                      if(res.category != "conferma" && res.category != "intercalare" && res.category != "sintomo"){
                          if(res.defaultResponse.length>0){
                              root.addRes(res.defaultResponse[0],false)
                          }
                      }
                      if(res.endConversation){
                          console.log("END")
                          root.addRes("Grazie per avermi usato! Puoi contattare la farmacia al <a href='tel:1234567891'>1234567891</a>",false)
                      }else{
                          ask(defaultIntents)
                      }
                      
                    }
                    if(res.category != "follow-up"){
                      sessionData.lastId = res.id
                    }
                }).catch(err=>{
                  console.log(err)
                  if(err!="ignore"){
                    root.addOptions([])
                    sessionData.confusionStage++
                    let confusedPhrases = [
                        "Potresti essere più specifico?",
                        "Scusami, non ho capito, potresti rifare la domanda?",
                        "Non ho capito :("
                    ]
                    if(sessionData.confusionStage>3){
                        sessionData.confusionStage = 0
                        root.addRes("Purtroppo sto avendo difficoltà a capire le tue domande, se il problema persiste ti consiglio di lasciare un feedback a test@test.com",false)
                    }else{
                        root.addRes(confusedPhrases[sessionData.lastIndex],false)
                    }
                    if(sessionData.lastIndex<2){
                        sessionData.lastIndex++
                    }else{
                        sessionData.lastIndex = 0
                    }
                  }
                    ask(defaultIntents)
              })
            })
        }


        if(localStorage.getItem("Farmacia")){
          JSON.parse(localStorage.getItem("Farmacia")).forEach(el=>{
          root.addMsg(el)
        })
        }
        root.addRes("Buogniorno, come posso esserti utile?",false)
        ask(defaultIntents);

        /* function initializeInput(){
            getMsg().then(res=>{
                detectIntent(res,defaultIntents).then(intent=>{
                    console.log(intent)
                })
                initializeInput()
            })
        }

        initializeInput() */
        

      </script>

</body>
</html>